{"id":"game-0ul","title":"Create hardcoded test map","description":"engine/map.go - Simple 2D grid map with walls and open spaces to test the raycaster.\n\n## Implementation Details\n\n### Files to Create\n- `engine/map.go`\n\n### Map Representation\n```go\ntype GameMap struct {\n    Width  int\n    Height int\n    Cells  [][]int  // 2D grid\n}\n\n// Cell values:\nconst (\n    CellEmpty  = 0  // walkable space\n    CellWall   = 1  // solid wall\n    CellStairs = 2  // stairs down (for later)\n)\n```\n\n### Required Functions\n```go\nfunc NewTestMap() *GameMap           // Returns hardcoded 16x16 test map\nfunc (m *GameMap) IsWall(x, y int) bool\nfunc (m *GameMap) IsValid(x, y int) bool  // bounds check\nfunc (m *GameMap) GetCell(x, y int) int\n```\n\n### Test Map Design (16x16)\n- Outer perimeter is all walls\n- Some internal walls to test raycasting\n- Open corridor for player movement\n- Clear spawn point (e.g., center-ish)\n- Include at least one corner, one long wall, one doorway\n\n### Acceptance Criteria\n- [ ] `engine/map.go` compiles\n- [ ] `NewTestMap()` returns a playable 16x16 map\n- [ ] Wall detection functions work correctly\n- [ ] Map has interesting geometry for raycaster testing\n\n### Notes\n- This is a temporary test map; procedural generation replaces it later\n- Keep it simple but varied enough to verify raycaster works","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:58.819635-08:00","updated_at":"2025-12-17T20:53:57.770362-08:00","closed_at":"2025-12-17T20:53:57.770362-08:00","close_reason":"Closed","dependencies":[{"issue_id":"game-0ul","depends_on_id":"game-e0m","type":"blocks","created_at":"2025-12-17T20:30:50.953819-08:00","created_by":"jon"}]}
{"id":"game-326","title":"Implement procedural floor generation","description":"world/generator.go - BSP or drunk walk algorithm. Depth influences weirdness. Guaranteed path to stairs.\n\n## Implementation Details\n\n### Files to Create\n- `world/generator.go`\n\n### Generator Interface\n```go\ntype FloorGenerator struct {\n    Width, Height int\n    Depth         int  // Current floor depth (affects generation)\n    Seed          int64\n}\n\nfunc NewFloorGenerator(width, height, depth int) *FloorGenerator\nfunc (g *FloorGenerator) Generate() *GameMap\n```\n\n### Algorithm: Drunk Walk (Recommended for MVP)\n1. Start with all walls\n2. Place \"drunk\" walker at center\n3. Walker moves randomly, carving empty cells\n4. Continue until ~40-50% of cells are empty\n5. Place stairs in a dead-end or far corner\n6. Validate path exists from spawn to stairs (BFS/flood fill)\n\n### Depth-Based Parameters\n```go\n// As depth increases:\n// - corridorWidth decreases (tighter spaces)\n// - deadEndChance increases (more maze-like)\n// - roomCount varies more wildly\n// - irregularity increases (weirder shapes)\n```\n\n### Output Requirements\n- Returns `*GameMap` with CellEmpty, CellWall, CellStairs\n- Spawn point (player start) stored or returned\n- Stairs location stored\n- All empty cells reachable from spawn\n\n### Validation\n```go\nfunc (g *FloorGenerator) validatePath(m *GameMap, spawn, stairs Point) bool\n// Use BFS/flood fill to ensure connectivity\n```\n\n### Acceptance Criteria\n- [ ] Generates playable floors every time\n- [ ] Stairs always reachable from spawn\n- [ ] Depth affects generation parameters\n- [ ] Different seeds produce different layouts\n- [ ] No isolated rooms (all empty space connected)\n- [ ] Reasonable generation time (\u003c100ms)\n\n### Notes\n- BSP is an alternative but drunk walk is simpler for MVP\n- Consider seeding with `depth + sessionSeed` for reproducibility\n- Deeper floors should feel more claustrophobic/non-Euclidean","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:58.988304-08:00","updated_at":"2025-12-17T21:26:42.159842-08:00","dependencies":[{"issue_id":"game-326","depends_on_id":"game-864","type":"blocks","created_at":"2025-12-17T20:30:51.476861-08:00","created_by":"jon"}]}
{"id":"game-864","title":"Add discrete player movement","description":"engine/player.go - W/S forward/back, A/D rotate 90°, Q quit. Discrete grid-based movement.\n\n## Implementation Details\n\n### Files to Create\n- `engine/player.go`\n\n### Player State\n```go\ntype Player struct {\n    X, Y      float64  // Position (center of current cell for rendering)\n    Angle     float64  // Direction in radians (0 = East, π/2 = North)\n    GridX, GridY int   // Current grid cell (for collision)\n}\n\n// Direction constants\nconst (\n    DirEast  = 0.0\n    DirNorth = math.Pi / 2\n    DirWest  = math.Pi\n    DirSouth = 3 * math.Pi / 2\n)\n```\n\n### Movement Functions\n```go\nfunc NewPlayer(startX, startY int) *Player\nfunc (p *Player) MoveForward(gameMap *GameMap)   // W key\nfunc (p *Player) MoveBackward(gameMap *GameMap)  // S key\nfunc (p *Player) RotateLeft()                    // A key - 90° counter-clockwise\nfunc (p *Player) RotateRight()                   // D key - 90° clockwise\n```\n\n### Collision Detection\n- Before moving, check `gameMap.IsWall(newX, newY)`\n- Only move if destination cell is empty (CellEmpty or CellStairs)\n- Grid-aligned movement: move exactly 1 cell per keypress\n\n### Input Handling Integration\n- Input should be processed in main game loop\n- Discrete movement = one cell per keypress, not continuous\n\n### Acceptance Criteria\n- [ ] Player struct tracks position and angle\n- [ ] W/S moves forward/backward one cell\n- [ ] A/D rotates exactly 90 degrees\n- [ ] Cannot walk through walls\n- [ ] Position correctly interfaces with raycaster\n- [ ] Spawn position configurable (for map generation)\n\n### Notes\n- Use float64 for position to allow smooth rendering interpolation later\n- Angle wraps properly (0 to 2π)\n- Start with discrete movement; smooth movement is a future enhancement","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:58.653597-08:00","updated_at":"2025-12-17T21:19:49.074977-08:00","closed_at":"2025-12-17T21:19:49.074977-08:00","close_reason":"Closed","dependencies":[{"issue_id":"game-864","depends_on_id":"game-dvr","type":"blocks","created_at":"2025-12-17T20:30:51.347885-08:00","created_by":"jon"}]}
{"id":"game-bp3","title":"Implement corruption system","description":"world/corruption.go + render/effects.go - Meter increases with depth. Visual glitches: char substitution, color bleeding, whispers.\n\n## Implementation Details\n\n### Files to Create\n- `world/corruption.go` - Corruption state and logic\n- `render/effects.go` - Visual effect implementations\n\n### Corruption State\n```go\ntype Corruption struct {\n    Level    float64  // 0.0 to 1.0\n    Depth    int      // Current floor depth\n    Ticks    int      // Frame counter for animation\n}\n\nfunc NewCorruption() *Corruption\nfunc (c *Corruption) Update(depth int)\nfunc (c *Corruption) GetLevel() float64\n```\n\n### Corruption Scaling\n```go\n// Corruption starts at floor 10, maxes around floor 50\nfunc (c *Corruption) calculateLevel(depth int) float64 {\n    if depth \u003c 10 { return 0.0 }\n    return min(1.0, float64(depth-10) / 40.0)\n}\n```\n\n### Visual Effects (render/effects.go)\n\n#### 1. Character Substitution\n```go\n// Randomly replace wall chars with glitchy alternatives\nvar glitchChars = []rune{'╳', '◊', '∆', '¤', '§', '░'}\nfunc ApplyCharGlitch(char rune, corruption float64) rune\n```\n\n#### 2. Color Bleeding\n```go\n// ANSI color shifts - walls occasionally wrong color\n// Use tcell.StyleDefault.Foreground(color)\nvar corruptColors = []tcell.Color{tcell.ColorRed, tcell.ColorMagenta, tcell.ColorDarkRed}\nfunc ApplyColorBleed(style tcell.Style, corruption float64) tcell.Style\n```\n\n#### 3. Text Whispers\n```go\n// Lovecraftian text fragments appearing on screen\nvar whispers = []string{\n    \"ph'nglui mglw'nafh\",\n    \"the deep calls\",\n    \"THEY SEE YOU\",\n    \"do not look back\",\n    \"the angles are wrong\",\n}\nfunc RenderWhisper(screen tcell.Screen, corruption float64)\n```\n\n#### 4. Fake Geometry (Advanced)\n```go\n// Illusory walls that flicker in/out\n// Doors that lead nowhere\nfunc ApplyFakeGeometry(screen tcell.Screen, corruption float64)\n```\n\n### Effect Application Order\n1. Raycaster renders base frame\n2. Apply character substitution (per-cell chance)\n3. Apply color bleeding (per-cell chance)\n4. Overlay whispers (low frequency, random position)\n5. Fake geometry (highest corruption only)\n\n### Acceptance Criteria\n- [ ] Corruption meter increases with depth\n- [ ] No effects below floor 10\n- [ ] Character glitches appear probabilistically\n- [ ] Colors occasionally shift/bleed\n- [ ] Whisper text appears at high corruption\n- [ ] Effects intensify with depth\n- [ ] Performance remains ~60fps with effects\n\n### Notes\n- Effects should be unsettling but not unplayable\n- Randomness seeded per-frame + position for consistency\n- Consider: corruption also increases slightly over time on same floor\n- Purely perceptual - no death, no gameplay impact","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:59.332738-08:00","updated_at":"2025-12-17T20:23:42.836553-08:00","dependencies":[{"issue_id":"game-bp3","depends_on_id":"game-l9h","type":"blocks","created_at":"2025-12-17T20:30:51.741677-08:00","created_by":"jon"}]}
{"id":"game-dvr","title":"Implement raycaster engine","description":"engine/raycaster.go - Cast rays per column, calculate wall distances, ASCII shading (█ ▓ ▒ ░ .)\n\n## Implementation Details\n\n### Files to Create\n- `engine/raycaster.go`\n- `render/shading.go` (ASCII character lookup)\n\n### Core Algorithm (DDA Raycasting)\nFor each screen column (0 to screenWidth):\n1. Calculate ray direction from player angle + column offset\n2. Step through map grid using DDA algorithm\n3. Detect wall hit, record perpendicular distance\n4. Calculate wall height: `wallHeight = screenHeight / distance`\n5. Draw column with appropriate ASCII shade\n\n### Key Types and Functions\n```go\ntype Raycaster struct {\n    ScreenWidth  int  // 120\n    ScreenHeight int  // 40\n    FOV          float64  // ~60° = π/3 radians\n}\n\nfunc (r *Raycaster) Render(screen tcell.Screen, player *Player, gameMap *GameMap)\nfunc (r *Raycaster) castRay(player *Player, gameMap *GameMap, rayAngle float64) float64\n```\n\n### ASCII Shading Table (distance-based)\n```go\n// Closer walls = denser characters\nvar shadeChars = []rune{'█', '▓', '▒', '░', '.', ' '}\n// Map distance to shade index\n```\n\n### Screen Layout (120x40)\n- Full screen is 3D view for MVP\n- Later: add HUD for depth counter, corruption meter\n\n### Acceptance Criteria\n- [ ] 3D view renders walls with distance-based shading\n- [ ] No fish-eye distortion (use perpendicular distance)\n- [ ] ~60fps performance maintained\n- [ ] Walls at different distances clearly distinguishable\n- [ ] Floor/ceiling rendered (simple fill or gradient)\n\n### Notes\n- Classic Wolfenstein 3D-style raycasting\n- Use `math.Cos`/`math.Sin` for ray direction\n- Perpendicular distance = `rayDist * cos(rayAngle - playerAngle)` to fix fish-eye","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:58.491392-08:00","updated_at":"2025-12-17T20:58:01.185742-08:00","closed_at":"2025-12-17T20:58:01.185742-08:00","close_reason":"Closed","dependencies":[{"issue_id":"game-dvr","depends_on_id":"game-tmm","type":"blocks","created_at":"2025-12-17T20:30:51.08994-08:00","created_by":"jon"},{"issue_id":"game-dvr","depends_on_id":"game-0ul","type":"blocks","created_at":"2025-12-17T20:30:51.220116-08:00","created_by":"jon"}]}
{"id":"game-e0m","title":"Initialize Go module and add tcell dependency","description":"Set up go.mod, add github.com/gdamore/tcell/v2 dependency\n\n## Implementation Details\n\n### Files to Create\n- `go.mod` in project root\n\n### Steps\n1. Run `go mod init game` (or appropriate module path)\n2. Run `go get github.com/gdamore/tcell/v2`\n3. Create minimal `main.go` that imports tcell and compiles\n\n### Acceptance Criteria\n- [ ] `go.mod` exists with tcell/v2 dependency\n- [ ] `go build` succeeds with a minimal main.go stub\n- [ ] Project follows file structure from ARCH.md\n\n### Notes\n- tcell chosen for cross-platform terminal rendering\n- Target resolution is 120x40 characters","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:58.172194-08:00","updated_at":"2025-12-17T20:40:55.900814-08:00","closed_at":"2025-12-17T20:40:55.900814-08:00","close_reason":"Closed"}
{"id":"game-l9h","title":"Add floor transitions with stairs","description":"world/floor.go - Stairs tile leads to next floor. Depth counter increases. New floor generated on descent.\n\n## Implementation Details\n\n### Files to Create\n- `world/floor.go`\n\n### Floor State\n```go\ntype Floor struct {\n    Map       *GameMap\n    Depth     int       // Current floor number (1, 2, 3...)\n    SpawnPos  Point     // Where player starts\n    StairsPos Point     // Location of stairs down\n}\n\ntype Point struct {\n    X, Y int\n}\n```\n\n### Floor Management\n```go\ntype FloorManager struct {\n    CurrentFloor *Floor\n    Generator    *FloorGenerator\n}\n\nfunc NewFloorManager() *FloorManager\nfunc (fm *FloorManager) GenerateFirstFloor() *Floor\nfunc (fm *FloorManager) DescendToNextFloor() *Floor\nfunc (fm *FloorManager) GetCurrentDepth() int\n```\n\n### Stair Interaction\n- When player steps on CellStairs (cell value 2):\n  - Trigger `DescendToNextFloor()`\n  - Generate new floor with `depth + 1`\n  - Reset player position to new floor's spawn\n  - Optionally: brief transition effect (screen flash/fade)\n\n### Integration with Game Loop\n```go\n// In update():\nif currentFloor.Map.GetCell(player.GridX, player.GridY) == CellStairs {\n    currentFloor = floorManager.DescendToNextFloor()\n    player.SetPosition(currentFloor.SpawnPos)\n}\n```\n\n### HUD Display\n- Depth counter should be visible (bottom of screen or corner)\n- Format: \"Depth: 7\" or \"Floor -7\"\n\n### Acceptance Criteria\n- [ ] Floor struct holds map, depth, spawn, stairs positions\n- [ ] Walking onto stairs triggers descent\n- [ ] New procedural floor generates on descent\n- [ ] Depth counter increments correctly\n- [ ] Player respawns at new floor's spawn point\n- [ ] Depth displayed on screen\n\n### Notes\n- No way to go back up (endless descent)\n- Deeper floors feed into corruption system (floor ~10+)\n- Consider seed = baseSeed + depth for deterministic generation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:59.159298-08:00","updated_at":"2025-12-17T20:23:42.716201-08:00","dependencies":[{"issue_id":"game-l9h","depends_on_id":"game-326","type":"blocks","created_at":"2025-12-17T20:30:51.610099-08:00","created_by":"jon"}]}
{"id":"game-tmm","title":"Create basic game loop in main.go","description":"Entry point with init, loop (input/update/render), cleanup. Target ~60fps.\n\n## Implementation Details\n\n### Files to Create/Modify\n- `main.go` - Main entry point\n\n### Core Structure\n```go\nfunc main() {\n    // init()\n    screen, _ := tcell.NewScreen()\n    screen.Init()\n    defer screen.Fini()\n    \n    // game state initialization\n    \n    // loop (target ~60fps = 16ms per frame)\n    for running {\n        handleInput(screen)  // poll events, handle W/A/S/D/Q\n        update()             // game state, corruption\n        render(screen)       // raycaster → screen buffer\n        screen.Show()        // flush to terminal\n        time.Sleep(16 * time.Millisecond)\n    }\n}\n```\n\n### Required Types\n- `Game` struct to hold: Screen, Player, Map, CurrentFloor, Corruption\n- Non-blocking input handling via `screen.PollEvent()`\n\n### Acceptance Criteria\n- [ ] tcell screen initializes and cleans up properly\n- [ ] Game loop runs at ~60fps\n- [ ] Q key exits the game cleanly\n- [ ] Basic text renders to screen (placeholder for raycaster output)\n- [ ] Window resize events handled gracefully\n\n### Notes\n- Keep render() as a stub that clears screen - raycaster implemented separately\n- Input handling should queue keypresses for discrete movement","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:16:58.33113-08:00","updated_at":"2025-12-17T20:43:12.815394-08:00","closed_at":"2025-12-17T20:43:12.815394-08:00","close_reason":"Closed","dependencies":[{"issue_id":"game-tmm","depends_on_id":"game-e0m","type":"blocks","created_at":"2025-12-17T20:30:50.807603-08:00","created_by":"jon"}]}
